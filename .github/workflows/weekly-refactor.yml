name: Weekly Refactor

on:
  schedule:
    # Run every Monday at 9:00 AM UTC
    - cron: "0 9 * * 1"
  workflow_dispatch:

permissions:
  issues: write
  contents: read

jobs:
  create-refactor-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create refactor issue
        uses: actions/github-script@v7
        with:
          script: |
            const issueBody = `Review the codebase and make improvements:

- Fix failing tests (superlinter, ci, ui tests)
- Refactor duplicate code
- Address security vulnerabilities
- Improve code maintainability and performance
- Enhance UI accessibility
- Increase test coverage

**Rules:** Make minimal surgical changes, run all linters/tests before completing.`;

            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: \`Weekly Refactor - \${new Date().toISOString().split('T')[0]}\`,
              body: issueBody,
              labels: ['refactor', 'automated', 'copilot']
            });

            console.log(\`Created issue #\${issue.data.number}\`);

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.data.number,
              body: '@copilot please handle this refactor task'
            });
