name: Weekly Refactor

on:
  schedule:
    # Run every Monday at 9:00 AM UTC
    - cron: "0 9 * * 1"
  workflow_dispatch:

permissions:
  issues: write
  contents: read

jobs:
  create-refactor-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create refactor issue
        uses: actions/github-script@v7
        with:
          script: |
            const issueBody = `Do at least the following and check if you can find more improvements that we can make:

            - Review and fix any failing tests in our codebase (superlinter, ci, ui tests)
            - Evaluate workflow triggers and optimize for efficiency
            - Check for code duplication and opportunities for refactoring
            - Review documentation for accuracy and completeness
            - Look for security vulnerabilities and address them
            - Identify outdated dependencies that should be updated
            - Check for performance optimization opportunities
            - Ensure all linting rules pass
            - Look for opportunities to improve code maintainability
            - Review error handling and logging practices
            - Check for accessibility improvements in the UI
            - Identify areas where custom agents could be beneficial
            - Review test coverage and add tests where needed

            **Guidelines:**
            - Make surgical, minimal changes that improve the codebase
            - Run all linters and tests before completing
            - Document any significant changes or decisions
            - Use existing tools and libraries when possible
            - Follow the existing code style and conventions

            This is an automated weekly refactor task. Focus on continuous improvement while maintaining stability.`;

            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: \`Weekly Refactor - \${new Date().toISOString().split('T')[0]}\`,
              body: issueBody,
              labels: ['refactor', 'automated', 'copilot']
            });

            console.log(\`Created issue #\${issue.data.number}\`);

            // Assign to copilot by adding a comment
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.data.number,
              body: '@copilot please handle this refactor task'
            });
