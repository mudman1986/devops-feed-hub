<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="DevOps Feed Hub Settings - Configure your RSS feed preferences"
    />
    <title>Settings - DevOps Feed Hub</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="favicon-48x48.png" />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="favicon-192x192.png"
    />
    <link rel="apple-touch-icon" sizes="192x192" href="favicon-192x192.png" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Skip to main content link for accessibility -->
    <a href="#settings-content" class="skip-to-main">Skip to main content</a>

    <div class="header">
      <div class="header-title">
        <svg
          width="40"
          height="40"
          viewBox="0 0 100 100"
          xmlns="http://www.w3.org/2000/svg"
        >
          <defs>
            <linearGradient
              id="header-grad"
              x1="0%"
              y1="0%"
              x2="100%"
              y2="100%"
            >
              <stop offset="0%" style="stop-color: #667eea; stop-opacity: 1" />
              <stop
                offset="100%"
                style="stop-color: #764ba2; stop-opacity: 1"
              />
            </linearGradient>
          </defs>
          <g fill="url(#header-grad)">
            <circle cx="50" cy="50" r="18" fill="url(#header-grad)" />
            <path d="M 50,10 L 45,22 L 55,22 Z" />
            <path d="M 78,28 L 71,34 L 77,40 Z" />
            <path d="M 90,50 L 78,45 L 78,55 Z" />
            <path d="M 78,72 L 77,60 L 71,66 Z" />
            <path d="M 50,90 L 55,78 L 45,78 Z" />
            <path d="M 22,72 L 29,66 L 23,60 Z" />
            <path d="M 10,50 L 22,55 L 22,45 Z" />
            <path d="M 22,28 L 23,40 L 29,34 Z" />
          </g>
          <circle cx="50" cy="50" r="8" fill="#ffffff" />
        </svg>
        DevOps Feed Hub
      </div>
      <div class="header-controls">
        <button
          class="settings-back-button"
          id="settings-back-button"
          aria-label="Back to feeds"
          onclick="window.location.href = 'index.html'"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
          <span>Back to Feeds</span>
        </button>
      </div>
    </div>
    <div class="settings-container">
      <nav class="settings-sidebar">
        <div class="settings-menu">
          <div
            class="settings-menu-item active"
            data-section="appearance"
            role="button"
            tabindex="0"
            aria-label="Appearance and display settings"
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="14.31" y1="8" x2="20.05" y2="17.94"></line>
              <line x1="9.69" y1="8" x2="21.17" y2="8"></line>
              <line x1="7.38" y1="12" x2="13.12" y2="2.06"></line>
              <line x1="9.69" y1="16" x2="3.95" y2="6.06"></line>
              <line x1="14.31" y1="16" x2="2.83" y2="16"></line>
              <line x1="16.62" y1="12" x2="10.88" y2="21.94"></line>
            </svg>
            <span>Appearance & Display</span>
          </div>
          <div
            class="settings-menu-item"
            data-section="feeds"
            role="button"
            tabindex="0"
            aria-label="Feed selection settings"
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M4 11a9 9 0 0 1 9 9"></path>
              <path d="M4 4a16 16 0 0 1 16 16"></path>
              <circle cx="5" cy="19" r="1"></circle>
            </svg>
            <span>Feed Selection</span>
          </div>
          <div
            class="settings-menu-item"
            data-section="rss"
            role="button"
            tabindex="0"
            aria-label="RSS feed settings"
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M4 11a9 9 0 0 1 9 9"></path>
              <path d="M4 4a16 16 0 0 1 16 16"></path>
              <circle cx="5" cy="19" r="1"></circle>
            </svg>
            <span>RSS Feeds</span>
          </div>
          <div
            class="settings-menu-item"
            data-section="experimental"
            role="button"
            tabindex="0"
            aria-label="experimental settings"
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
              <polyline points="2 17 12 22 22 17"></polyline>
              <polyline points="2 12 12 17 22 12"></polyline>
            </svg>
            <span>Experimental Themes</span>
          </div>
        </div>
      </nav>
      <main class="settings-content" id="settings-content">
        <section class="settings-section active" id="appearance-section">
          <h2 class="settings-section-title">Appearance & Display</h2>
          <div class="settings-group">
            <div class="settings-item">
              <div class="settings-item-label">
                <label for="theme-mode-setting">Theme Mode</label>
                <p class="settings-item-description">
                  Choose between light and dark mode for all themes
                </p>
              </div>
              <div class="settings-item-control">
                <select id="theme-mode-setting" class="settings-select">
                  <option value="dark">Dark Mode</option>
                  <option value="light">Light Mode</option>
                </select>
              </div>
            </div>
            <div class="settings-item">
              <div class="settings-item-label">
                <label for="theme-setting">Theme</label>
                <p class="settings-item-description">
                  Select the default theme (works with both light and dark mode)
                </p>
              </div>
              <div class="settings-item-control">
                <select id="theme-setting" class="settings-select">
                  <option value="default">Default</option>
                </select>
              </div>
            </div>
            <div class="settings-item">
              <div class="settings-item-label">
                <label for="view-setting">View Mode</label>
                <p class="settings-item-description">
                  Choose how articles are displayed
                </p>
              </div>
              <div class="settings-item-control">
                <select id="view-setting" class="settings-select">
                  <option value="list">List View</option>
                  <option value="card">Card View</option>
                </select>
              </div>
            </div>
            <div class="settings-item">
              <div class="settings-item-label">
                <label for="timeframe-setting">Default Time Range</label>
                <p class="settings-item-description">
                  Set the default time range for article filtering
                </p>
              </div>
              <div class="settings-item-control">
                <select id="timeframe-setting" class="settings-select">
                  <option value="1day">Last 24 hours</option>
                  <option value="7days">Last 7 days</option>
                  <option value="30days">Last 30 days</option>
                </select>
              </div>
            </div>
          </div>
        </section>

        <section class="settings-section" id="feeds-section">
          <h2 class="settings-section-title">Feed Selection</h2>
          <div class="settings-group">
            <p class="settings-group-description">
              Select which feeds you want to see. Disabled feeds will be hidden
              from the navigation and main view.
            </p>
            <div class="settings-item">
              <div class="settings-item-actions">
                <button
                  id="select-all-feeds"
                  class="settings-action-button"
                  aria-label="Select all feeds"
                >
                  Select All
                </button>
                <button
                  id="deselect-all-feeds"
                  class="settings-action-button"
                  aria-label="Deselect all feeds in the list"
                >
                  Deselect All
                </button>
              </div>
            </div>
            <div id="feed-checkboxes" class="feed-checkboxes">
              <!-- Feed checkboxes will be dynamically inserted here -->
            </div>
          </div>
        </section>

        <section class="settings-section" id="rss-section">
          <h2 class="settings-section-title">RSS Feeds</h2>
          <div class="settings-group">
            <p class="settings-group-description">
              Subscribe to RSS feeds to get updates in your favorite RSS reader.
            </p>
            <div class="settings-item">
              <div class="settings-item-label">
                <label>All Articles</label>
                <p class="settings-item-description">
                  Get all articles from all feeds in one RSS feed
                </p>
              </div>
              <div class="settings-item-control">
                <a
                  href="feed.xml"
                  class="settings-button"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M4 11a9 9 0 0 1 9 9"></path>
                    <path d="M4 4a16 16 0 0 1 16 16"></path>
                    <circle cx="5" cy="19" r="1"></circle>
                  </svg>
                  Subscribe to All
                </a>
              </div>
            </div>
            <div id="rss-feed-links" class="rss-feed-links">
              <!-- Individual RSS feed links will be dynamically inserted here -->
            </div>
          </div>
        </section>

        <section class="settings-section" id="experimental-section">
          <h2 class="settings-section-title" id="experimental-section-title">
            Experimental Themes
          </h2>
          <div
            class="settings-group experimental-themes"
            role="region"
            aria-labelledby="experimental-section-title"
          >
            <div class="experimental-disclaimer">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                style="flex-shrink: 0; margin-top: 0.125rem"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              <p>
                <strong>Work in Progress:</strong> These experimental themes are
                under active development and may change or be removed without
                notice. They represent different visual and layout approaches to
                explore alternative UI/UX designs.
              </p>
            </div>

            <div class="settings-item">
              <div class="settings-item-label">
                <label for="experimental-theme-setting"
                  >Experimental Color Theme</label
                >
                <p class="settings-item-description">
                  Try out new color schemes (works with dark/light mode toggle)
                </p>
              </div>
              <div class="settings-item-control">
                <select id="experimental-theme-setting" class="settings-select">
                  <option value="">None (Use Default Theme)</option>
                  <optgroup label="Color Variations">
                    <option value="purple-haze">Purple Haze</option>
                    <option value="ocean-deep">Ocean Deep</option>
                    <option value="arctic-blue">Arctic Blue</option>
                    <option value="high-contrast">High Contrast</option>
                    <option value="monochrome">Monochrome</option>
                    <option value="dracula">Dracula</option>
                  </optgroup>
                  <optgroup label="Themed Styles">
                    <option value="minimalist">
                      Minimalist - Clean & Simple
                    </option>
                    <option value="terminal">
                      Terminal - Monospace Command-Line
                    </option>
                    <option value="retro">Retro - 80s/90s Inspired</option>
                    <option value="futuristic">Futuristic - Sci-Fi Neon</option>
                    <option value="compact">Compact - Dense Information</option>
                  </optgroup>
                </select>
              </div>
            </div>
            <div class="settings-item">
              <div class="settings-item-label">
                <label for="experimental-viewmode-setting"
                  >Experimental View Mode</label
                >
                <p class="settings-item-description">
                  Try out alternative layout arrangements
                </p>
              </div>
              <div class="settings-item-control">
                <select
                  id="experimental-viewmode-setting"
                  class="settings-select"
                >
                  <option value="">None (Use Standard View)</option>
                  <optgroup label="Alternative Layouts">
                    <option value="horizontal-scroll">
                      Horizontal Scroll - Side-to-Side
                    </option>
                    <option value="masonry-grid">
                      Masonry Grid - Pinterest Style
                    </option>
                    <option value="floating-panels">
                      Floating Panels - Tilted Cards
                    </option>
                    <option value="center-stage">
                      Center Stage - Single Column Centered
                    </option>
                    <option value="top-strip">
                      Top Strip - Drudge Report Style
                    </option>
                    <option value="list-dense">
                      List Dense - Reddit/HN Style
                    </option>
                    <option value="timeline-vertical">
                      Timeline Vertical - Medium/Substack Style
                    </option>
                  </optgroup>
                </select>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script src="script.js"></script>
    <script>
      // Settings page-specific functionality
      (() => {
        "use strict";

        // Get all available feeds from navigation
        function _getAllFeeds() {
          // This will be populated when the main index.html is generated
          // For now, we'll fetch it from the existing navigation if available
          const feeds = [];
          // We'll populate this dynamically from localStorage or a fetch
          return feeds;
        }

        // Initialize settings page
        function initSettings() {
          // Menu navigation
          const menuItems = document.querySelectorAll(".settings-menu-item");
          const sections = document.querySelectorAll(".settings-section");

          menuItems.forEach((item) => {
            item.addEventListener("click", () => {
              const sectionId = item.getAttribute("data-section");

              // Update active menu item
              menuItems.forEach((mi) => {
                mi.classList.remove("active");
              });
              item.classList.add("active");

              // Update active section
              sections.forEach((section) => {
                section.classList.remove("active");
              });
              const targetSection = document.getElementById(
                `${sectionId}-section`,
              );
              if (targetSection) {
                targetSection.classList.add("active");
              }
            });
          });

          // Load current settings
          loadSettings();

          // Setup event listeners for settings controls
          setupSettingsListeners();

          // Load and display feed checkboxes
          loadFeedCheckboxes();

          // Load and display RSS feed links
          loadRSSFeedLinks();
        }

        // List of base experimental themes (without -light/-dark suffixes)
        const EXPERIMENTAL_BASE_THEMES = [
          "purple-haze",
          "ocean-deep",
          "arctic-blue",
          "high-contrast",
          "monochrome",
          "dracula",
          "minimalist",
          "terminal",
          "retro",
          "futuristic",
          "compact",
        ];

        // List of experimental view modes (layout alternatives)
        const EXPERIMENTAL_VIEW_MODES = [
          "horizontal-scroll",
          "masonry-grid",
          "floating-panels",
          "center-stage",
          "top-strip",
          "list-dense",
          "timeline-vertical",
        ];

        // All valid experimental themes including variants
        const VALID_EXPERIMENTAL_THEMES = [
          ...EXPERIMENTAL_BASE_THEMES,
          ...EXPERIMENTAL_BASE_THEMES.map((t) => `${t}-light`),
          ...EXPERIMENTAL_BASE_THEMES.map((t) => `${t}-dark`),
          ...EXPERIMENTAL_VIEW_MODES,
        ];

        /**
         * Get the base theme name (without -light or -dark suffix)
         */
        function getBaseTheme(theme) {
          if (!theme) return null;
          return theme.replace(/-light$|-dark$/, "");
        }

        /**
         * Determine if a theme is light mode
         */
        function isLightMode(theme) {
          if (!theme) return false;
          if (theme === "arctic-blue") return true;
          return theme.endsWith("-light") || theme === "light";
        }

        /**
         * Get current mode (light or dark)
         */
        function getCurrentMode(theme) {
          return isLightMode(theme) ? "light" : "dark";
        }

        /**
         * Apply mode to a theme
         */
        function applyModeToTheme(baseTheme, mode) {
          if (!baseTheme) return mode;
          
          // View modes don't have light/dark variants
          if (EXPERIMENTAL_VIEW_MODES.includes(baseTheme)) {
            return baseTheme;
          }
          
          // Standard themes (light/dark) - these are already full theme names
          if (baseTheme === "light" || baseTheme === "dark") {
            return mode;
          }
          
          // Arctic-blue is naturally light, so no suffix for light mode
          if (baseTheme === "arctic-blue") {
            return mode === "light" ? "arctic-blue" : "arctic-blue-dark";
          }
          
          // For other experimental themes, append mode suffix
          if (EXPERIMENTAL_BASE_THEMES.includes(baseTheme)) {
            return mode === "light" ? `${baseTheme}-light` : baseTheme;
          }
          
          return baseTheme;
        }

        // Helper function to apply theme
        function applyTheme(themeName) {
          if (
            themeName &&
            !VALID_EXPERIMENTAL_THEMES.includes(themeName) &&
            themeName !== "dark" &&
            themeName !== "light"
          ) {
            console.warn(`Invalid theme: ${themeName}. Falling back to dark.`);
            themeName = "dark";
          }
          document.documentElement.setAttribute(
            "data-theme",
            themeName || "dark",
          );
        }

        function loadSettings() {
          // Load theme mode (light or dark)
          try {
            const themeMode = localStorage.getItem("themeMode") || "dark";
            const themeModeSelect = document.getElementById("theme-mode-setting");
            if (themeModeSelect) themeModeSelect.value = themeMode;
          } catch (e) {
            console.warn("Unable to load theme mode setting:", e);
          }

          // Load theme (default or experimental base theme)
          try {
            const experimentalTheme = localStorage.getItem("experimentalTheme") || "";
            const baseTheme = getBaseTheme(experimentalTheme) || "default";
            const themeSelect = document.getElementById("theme-setting");
            if (themeSelect) themeSelect.value = baseTheme;
          } catch (e) {
            console.warn("Unable to load theme setting:", e);
          }

          // Load experimental theme
          try {
            const experimentalTheme =
              localStorage.getItem("experimentalTheme") || "";
            const experimentalThemeSelect = document.getElementById(
              "experimental-theme-setting",
            );
            const experimentalViewmodeSelect = document.getElementById(
              "experimental-viewmode-setting",
            );

            // Determine if the stored value is a theme or viewmode
            if (experimentalTheme) {
              const viewModeThemes = [
                "horizontal-scroll",
                "masonry-grid",
                "floating-panels",
                "center-stage",
                "top-strip",
                "list-dense",
                "timeline-vertical",
              ];

              const baseTheme = getBaseTheme(experimentalTheme);
              
              if (viewModeThemes.includes(experimentalTheme)) {
                if (experimentalViewmodeSelect) {
                  experimentalViewmodeSelect.value = experimentalTheme;
                }
              } else if (EXPERIMENTAL_BASE_THEMES.includes(baseTheme)) {
                if (experimentalThemeSelect) {
                  experimentalThemeSelect.value = baseTheme;
                }
              }

              // Apply experimental theme if set and valid
              if (VALID_EXPERIMENTAL_THEMES.includes(experimentalTheme)) {
                applyTheme(experimentalTheme);
              }
            }
          } catch (e) {
            console.warn("Unable to load experimental theme setting:", e);
          }

          // Load view
          try {
            const view = localStorage.getItem("view") || "list";
            const viewSelect = document.getElementById("view-setting");
            if (viewSelect) viewSelect.value = view;
          } catch (e) {
            console.warn("Unable to load view setting:", e);
          }

          // Load timeframe
          try {
            const timeframe = localStorage.getItem("timeframe") || "1day";
            const timeframeSelect =
              document.getElementById("timeframe-setting");
            if (timeframeSelect) timeframeSelect.value = timeframe;
          } catch (e) {
            console.warn("Unable to load timeframe setting:", e);
          }
        }

        function setupSettingsListeners() {
          // Theme Mode setting (light/dark)
          const themeModeSelect = document.getElementById("theme-mode-setting");
          if (themeModeSelect) {
            themeModeSelect.addEventListener("change", async (e) => {
              const mode = e.target.value;
              LoadingState.show(themeModeSelect, "Applying mode");
              try {
                localStorage.setItem("themeMode", mode);
                
                // Get current theme and apply the new mode to it
                const currentTheme = document.documentElement.getAttribute("data-theme");
                const baseTheme = getBaseTheme(currentTheme);
                const experimentalTheme = localStorage.getItem("experimentalTheme");
                
                let newTheme;
                if (experimentalTheme && EXPERIMENTAL_VIEW_MODES.includes(experimentalTheme)) {
                  // View modes don't change with mode
                  newTheme = experimentalTheme;
                } else if (baseTheme && EXPERIMENTAL_BASE_THEMES.includes(baseTheme)) {
                  // Apply mode to experimental theme
                  newTheme = applyModeToTheme(baseTheme, mode);
                  localStorage.setItem("experimentalTheme", newTheme);
                } else {
                  // Standard theme: just "light" or "dark"
                  newTheme = mode;
                  localStorage.setItem("theme", newTheme);
                }
                
                applyTheme(newTheme);

                LoadingState.hide(themeModeSelect);
                showToast(
                  `Mode changed to ${mode === "dark" ? "Dark" : "Light"}`,
                  "success",
                );
              } catch (err) {
                console.warn("Unable to save theme mode:", err);
                LoadingState.hide(themeModeSelect);
                showToast("Failed to save theme mode", "error");
              }
            });
          }

          // Theme setting (default theme selector)
          const themeSelect = document.getElementById("theme-setting");
          if (themeSelect) {
            themeSelect.addEventListener("change", async (e) => {
              const theme = e.target.value;
              LoadingState.show(themeSelect, "Applying theme");
              try {
                const mode = localStorage.getItem("themeMode") || "dark";
                
                // Clear experimental theme when default theme is selected
                localStorage.removeItem("experimentalTheme");
                const experimentalThemeSelect = document.getElementById(
                  "experimental-theme-setting",
                );
                const experimentalViewmodeSelect = document.getElementById(
                  "experimental-viewmode-setting",
                );
                if (experimentalThemeSelect) experimentalThemeSelect.value = "";
                if (experimentalViewmodeSelect)
                  experimentalViewmodeSelect.value = "";
                
                // Apply mode to default theme
                const newTheme = mode;
                localStorage.setItem("theme", newTheme);
                applyTheme(newTheme);

                LoadingState.hide(themeSelect);
                showToast(
                  `Theme changed to Default`,
                  "success",
                );
              } catch (err) {
                console.warn("Unable to save theme:", err);
                LoadingState.hide(themeSelect);
                showToast("Failed to save theme setting", "error");
              }
            });
          }

          // Experimental theme setting
          const experimentalThemeSelect = document.getElementById(
            "experimental-theme-setting",
          );
          if (experimentalThemeSelect) {
            experimentalThemeSelect.addEventListener("change", async (e) => {
              const baseTheme = e.target.value;
              LoadingState.show(experimentalThemeSelect, "Applying theme");
              try {
                if (baseTheme) {
                  // Get current mode
                  const mode = localStorage.getItem("themeMode") || "dark";
                  
                  // Apply mode to experimental theme
                  const fullTheme = applyModeToTheme(baseTheme, mode);
                  
                  // Save experimental theme with mode applied
                  if (VALID_EXPERIMENTAL_THEMES.includes(fullTheme) || 
                      EXPERIMENTAL_BASE_THEMES.includes(baseTheme)) {
                    localStorage.setItem("experimentalTheme", fullTheme);
                    applyTheme(fullTheme);
                    
                    // Clear viewmode dropdown when theme is selected
                    const viewmodeSelect = document.getElementById(
                      "experimental-viewmode-setting",
                    );
                    if (viewmodeSelect) viewmodeSelect.value = "";

                    LoadingState.hide(experimentalThemeSelect);
                    showToast(
                      `Experimental theme applied: ${baseTheme}`,
                      "success",
                    );
                  } else {
                    console.warn(
                      `Invalid experimental theme: ${baseTheme}`,
                    );
                    LoadingState.hide(experimentalThemeSelect);
                    showToast("Invalid experimental theme", "error");
                  }
                } else {
                  // Clear experimental theme and revert to default theme
                  localStorage.removeItem("experimentalTheme");
                  const mode = localStorage.getItem("themeMode") || "dark";
                  const theme = localStorage.getItem("theme") || mode;
                  applyTheme(theme);

                  LoadingState.hide(experimentalThemeSelect);
                  showToast("Experimental theme cleared", "info");
                }
              } catch (err) {
                console.warn("Unable to save experimental theme:", err);
                LoadingState.hide(experimentalThemeSelect);
                showToast("Failed to save experimental theme", "error");
              }
            });
          }

          // Experimental viewmode setting
          const experimentalViewmodeSelect = document.getElementById(
            "experimental-viewmode-setting",
          );
          if (experimentalViewmodeSelect) {
            experimentalViewmodeSelect.addEventListener("change", (e) => {
              const experimentalViewmode = e.target.value;
              try {
                if (experimentalViewmode) {
                  // Save experimental viewmode if valid
                  if (
                    VALID_EXPERIMENTAL_THEMES.includes(experimentalViewmode)
                  ) {
                    localStorage.setItem(
                      "experimentalTheme",
                      experimentalViewmode,
                    );
                    applyTheme(experimentalViewmode);
                    // Clear theme dropdown when viewmode is selected
                    const themeSelect = document.getElementById(
                      "experimental-theme-setting",
                    );
                    if (themeSelect) themeSelect.value = "";
                  } else {
                    console.warn(
                      `Invalid experimental viewmode: ${experimentalViewmode}`,
                    );
                  }
                } else {
                  // Clear experimental viewmode
                  localStorage.removeItem("experimentalTheme");
                  const theme = localStorage.getItem("theme") || "dark";
                  applyTheme(theme);
                }
              } catch (err) {
                console.warn("Unable to save experimental viewmode:", err);
              }
            });
          }

          // View setting
          const viewSelect = document.getElementById("view-setting");
          if (viewSelect) {
            viewSelect.addEventListener("change", async (e) => {
              const view = e.target.value;
              LoadingState.show(viewSelect, "Updating view mode");
              try {
                localStorage.setItem("view", view);
                LoadingState.hide(viewSelect);
                showToast(
                  `View mode changed to ${view === "card" ? "Card" : "List"} view`,
                  "success",
                );
              } catch (err) {
                console.warn("Unable to save view:", err);
                LoadingState.hide(viewSelect);
                showToast("Failed to save view mode", "error");
              }
            });
          }

          // Timeframe setting
          const timeframeSelect = document.getElementById("timeframe-setting");
          if (timeframeSelect) {
            timeframeSelect.addEventListener("change", async (e) => {
              const timeframe = e.target.value;
              LoadingState.show(timeframeSelect, "Updating time range");
              try {
                localStorage.setItem("timeframe", timeframe);
                LoadingState.hide(timeframeSelect);
                const timeframeLabels = {
                  "1day": "Last 24 hours",
                  "7days": "Last 7 days",
                  "30days": "Last 30 days",
                };
                showToast(
                  `Time range updated to ${timeframeLabels[timeframe] || timeframe}`,
                  "success",
                );
              } catch (err) {
                console.warn("Unable to save timeframe:", err);
                LoadingState.hide(timeframeSelect);
                showToast("Failed to save time range", "error");
              }
            });
          }

          // Select/Deselect all feeds
          const selectAllBtn = document.getElementById("select-all-feeds");
          const deselectAllBtn = document.getElementById("deselect-all-feeds");

          if (selectAllBtn) {
            selectAllBtn.addEventListener("click", () => {
              const checkboxes = document.querySelectorAll(
                '.feed-checkbox-item input[type="checkbox"]',
              );
              checkboxes.forEach((cb) => {
                cb.checked = true;
              });
              saveFeedSettings();
            });
          }

          if (deselectAllBtn) {
            deselectAllBtn.addEventListener("click", () => {
              const checkboxes = document.querySelectorAll(
                '.feed-checkbox-item input[type="checkbox"]',
              );
              checkboxes.forEach((cb) => {
                cb.checked = false;
              });
              saveFeedSettings();
            });
          }
        }

        function loadFeedCheckboxes() {
          // Get enabled feeds from localStorage
          let enabledFeeds = [];
          try {
            const stored = localStorage.getItem("enabledFeeds");
            enabledFeeds = stored ? JSON.parse(stored) : [];
          } catch (e) {
            console.warn("Unable to load enabled feeds:", e);
          }

          const feedContainer = document.getElementById("feed-checkboxes");
          if (!feedContainer) return;

          // Try to fetch the feed list from index.html
          fetch("index.html")
            .then((response) => response.text())
            .then((html) => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, "text/html");
              const feedListEl = doc.getElementById("feed-list-data");

              let feeds = [];
              if (feedListEl?.textContent) {
                try {
                  feeds = JSON.parse(feedListEl.textContent);
                } catch (e) {
                  console.warn("Unable to parse feed list:", e);
                }
              }

              // If fetch failed or no data, use default list
              if (feeds.length === 0) {
                feeds = getDefaultFeedList();
              }

              renderFeedCheckboxes(feeds, enabledFeeds, feedContainer);
            })
            .catch(() => {
              // If fetch fails, use default list
              const feeds = getDefaultFeedList();
              renderFeedCheckboxes(feeds, enabledFeeds, feedContainer);
            });
        }

        function getDefaultFeedList() {
          return [
            "Atlassian DevOps",
            "AWS DevOps Blog",
            "Azure Updates",
            "CircleCI Blog",
            "Docker Blog",
            "GitHub Blog",
            "GitHub Changelog",
            "GitLab Blog",
            "HashiCorp Blog",
            "Jenkins Blog",
            "Kubernetes Blog",
            "Microsoft Azure Blog",
            "Microsoft DevOps Blog",
            "Microsoft Entra Blog",
            "Microsoft Security",
            "Opensource.com",
            "Red Hat Developer",
            "Terraform weekly",
          ];
        }

        function renderFeedCheckboxes(feeds, enabledFeeds, container) {
          // If no feeds are stored yet, enable all by default
          if (enabledFeeds.length === 0) {
            enabledFeeds = [...feeds];
            try {
              localStorage.setItem(
                "enabledFeeds",
                JSON.stringify(enabledFeeds),
              );
            } catch (e) {
              console.warn("Unable to save enabled feeds:", e);
            }
          }

          // Sort feeds alphabetically
          feeds.sort();

          // Create checkboxes
          feeds.forEach((feedName) => {
            const item = document.createElement("div");
            item.className = "feed-checkbox-item";

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.id = `feed-${feedName.replace(/\s+/g, "-").toLowerCase()}`;
            checkbox.value = feedName;
            checkbox.checked = enabledFeeds.includes(feedName);

            checkbox.addEventListener("change", saveFeedSettings);

            const label = document.createElement("label");
            label.setAttribute("for", checkbox.id);
            label.textContent = feedName;

            item.appendChild(checkbox);
            item.appendChild(label);
            container.appendChild(item);
          });
        }

        function loadRSSFeedLinks() {
          const rssContainer = document.getElementById("rss-feed-links");
          if (!rssContainer) return;

          // Try to fetch the feed list from index.html
          fetch("index.html")
            .then((response) => response.text())
            .then((html) => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, "text/html");
              const feedListEl = doc.getElementById("feed-list-data");

              let feeds = [];
              if (feedListEl?.textContent) {
                try {
                  feeds = JSON.parse(feedListEl.textContent);
                } catch (e) {
                  console.warn("Unable to parse feed list:", e);
                }
              }

              // If fetch failed or no data, use default list
              if (feeds.length === 0) {
                feeds = getDefaultFeedList();
              }

              renderRSSFeedLinks(feeds, rssContainer);
            })
            .catch(() => {
              // If fetch fails, use default list
              const feeds = getDefaultFeedList();
              renderRSSFeedLinks(feeds, rssContainer);
            });
        }

        function renderRSSFeedLinks(feeds, container) {
          // Sort feeds alphabetically
          feeds.sort();

          // Create RSS feed link for each feed
          feeds.forEach((feedName) => {
            // Generate slug from feed name (lowercase, replace spaces with hyphens)
            const feedSlug = feedName.toLowerCase().replace(/\s+/g, "-");

            const item = document.createElement("div");
            item.className = "settings-item";

            const labelDiv = document.createElement("div");
            labelDiv.className = "settings-item-label";

            const label = document.createElement("label");
            label.textContent = feedName;
            labelDiv.appendChild(label);

            const controlDiv = document.createElement("div");
            controlDiv.className = "settings-item-control";

            const link = document.createElement("a");
            link.href = `feed-${feedSlug}.xml`;
            link.className = "settings-button";
            link.target = "_blank";
            link.rel = "noopener noreferrer";

            link.innerHTML = `
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M4 11a9 9 0 0 1 9 9"></path>
                <path d="M4 4a16 16 0 0 1 16 16"></path>
                <circle cx="5" cy="19" r="1"></circle>
              </svg>
              Subscribe
            `;

            controlDiv.appendChild(link);
            item.appendChild(labelDiv);
            item.appendChild(controlDiv);
            container.appendChild(item);
          });
        }

        function saveFeedSettings() {
          const checkboxes = document.querySelectorAll(
            '.feed-checkbox-item input[type="checkbox"]',
          );
          const enabledFeeds = [];

          checkboxes.forEach((cb) => {
            if (cb.checked) {
              enabledFeeds.push(cb.value);
            }
          });

          try {
            localStorage.setItem("enabledFeeds", JSON.stringify(enabledFeeds));
            showToast(
              `Feed selection saved (${enabledFeeds.length} feeds enabled)`,
              "success",
            );
          } catch (e) {
            console.warn("Unable to save feed settings:", e);
            showToast("Failed to save feed selection", "error");
          }
        }

        // Initialize when DOM is ready
        if (
          document.readyState === "complete" ||
          document.readyState === "interactive"
        ) {
          setTimeout(initSettings, 0);
        } else {
          document.addEventListener("DOMContentLoaded", initSettings);
        }
      })();
    </script>
  </body>
</html>
